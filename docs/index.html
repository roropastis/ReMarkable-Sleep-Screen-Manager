<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>ReMarkable Sleep Screen Manager – Galerie</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
  :root{--cols:3}
  body{font:16px/1.4 system-ui,Segoe UI,Roboto,Arial,sans-serif;margin:24px;max-width:1100px}
  header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
  .grid{
    display:grid;
    grid-template-columns:repeat(var(--cols),1fr);
    gap:16px;
  }
  @media (max-width:980px){:root{--cols:2}}
  @media (max-width:640px){:root{--cols:1}}

  .card{border:1px solid #e3e3e3;border-radius:12px;padding:12px}
  .ph{ /* placeholder qui donne la hauteur à la vignette */
    width:100%;
    aspect-ratio: var(--ar, 3 / 4); /* par défaut 3:4 portrait */
    border-radius:10px;
    background:#f5f5f5;
    display:flex;align-items:center;justify-content:center;
    overflow:hidden;margin-bottom:8px;
  }
  .ph img{
    width:100%; height:100%;
    object-fit: contain; /* voir l'image entière (pas de crop) */
    image-rendering:auto;
  }
  .meta{color:#666;font-size:12px;margin:4px 0 8px}
  .row{display:flex;gap:8px;justify-content:flex-end}
  .btn{padding:8px 10px;border:1px solid #ccc;border-radius:8px;text-decoration:none;color:#222}
  footer{margin-top:28px;color:#777;font-size:12px;text-align:center}
</style>

</head>
<body>
  <header>
    <h1>Galerie – ReMarkable Sleep Screen Manager</h1>
    <a class="btn" href="https://github.com/<ton-user>/<ton-repo>" target="_blank">GitHub</a>
  </header>

  <div id="grid" class="grid">Chargement…</div>

  <footer>© 2025 <ton-user> • <a href="gallery/index.json">catalogue JSON</a></footer>

  <script>
  const INDEX_URL = 'gallery/index.json';

  function parseAspect(res){
    // res comme "1620x2160" → "1620 / 2160"
    if(!res) return "3 / 4";
    const m = res.match(/^(\d+)\s*x\s*(\d+)$/i);
    if(!m) return "3 / 4";
    const w = +m[1], h = +m[2];
    return `${w} / ${h}`;
  }

  fetch(INDEX_URL).then(r=>r.json()).then(({items})=>{
    const grid = document.getElementById('grid');
    grid.innerHTML = '';
    (items||[]).forEach(it=>{
      const card = document.createElement('div');
      card.className = 'card';
      // ratio depuis resolution (sinon 3/4)
      const ar = parseAspect(it.resolution);

      card.innerHTML = `
        <div class="ph" style="--ar:${ar}">
          <img loading="lazy" src="${it.preview_url}" alt="${it.title}">
        </div>
        <h3>${it.title||''}</h3>
        <div class="meta">
          ${(it.author||'').trim()} ${it.author?'•':''} ${it.resolution||''}
        </div>
        <div class="row">
          <a class="btn" href="${it.download_url}" download>Télécharger</a>
        </div>
      `;
      grid.appendChild(card);
    });
  }).catch(err=>{
    document.getElementById('grid').textContent = 'Erreur de chargement : ' + err;
  });
</script>

</body>
</html>
